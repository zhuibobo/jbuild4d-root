<!DOCTYPE html><html lang="zh" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"><head><meta charset="UTF-8"><title>Title</title><th:block th:replace="Fragment/GeneralLib::GeneralLib"></th:block><th:block th:replace="Fragment/GeneralLib::ZTreeExtendLib"></th:block><th:block th:replace="Fragment/GeneralLib::ThemesLib"></th:block></head><body><div id="appList" class="list-2column"><div class="left-outer-wrap-c"><div class="left-page-c" style="width:250px"><div class="tool-bar-c"><div alt="新增组" title="新增组" class="add" @click="addGroup()"></div><div alt="修改组" title="修改组" class="edit" @click="editGroup"></div><div alt="删除组" title="删除组" class="del" @click="delGroup"></div><div alt="浏览组" title="浏览组" class="view" @click="viewGroup"></div></div><div><ul id="zTreeUL" class="ztree"></ul></div></div></div><div class="right-outer-wrap-c" style="padding:10px;left:260px"><div style="width:100%"><div style="float:right;margin-bottom:15px;margin-top:10px;margin-right:10px"><button-group><i-button type="success" @click="add()"><icon type="plus"></icon>新增</i-button><i-button type="primary" @click="edit()"><icon type="edit"></icon>修改</i-button><i-button type="primary" @click="del()"><icon type="trash-a"></icon>删除</i-button><i-button type="primary" @click="view()"><icon type="android-open"></icon>浏览</i-button><i-button type="primary" @click="statusEnable('启用')"><icon type="checkmark-round"></icon>启用</i-button><i-button type="primary" @click="statusEnable('禁用')"><icon type="minus-round"></icon>禁用</i-button><i-button type="primary" @click="setSelected()"><icon type="checkmark-round"></icon>设为选中</i-button><i-button type="primary" @click="move('up')"><icon type="arrow-up-b"></icon>上移</i-button><i-button type="primary" @click="move('down')"><icon type="arrow-down-b"></icon>下移</i-button></button-group></div></div><div id="divTreeTable" style="width:98%;margin:auto"></div></div></div><script>var treeTableObj=null,appList=new Vue({el:"#appList",mounted:function(){this.initTree()},data:{acInterface:{getGroupTreeData:"/PlatForm/System/DictionaryGroup/GetTreeData",groupEditView:"/PlatForm/System/DictionaryGroup/DetailView",deleteGroup:"/PlatForm/System/DictionaryGroup/Delete",dictEditView:"/PlatForm/System/Dictionary/DetailView",getDictData:"/PlatForm/System/Dictionary/GetListDataByGroupId",deleteDict:"/PlatForm/System/Dictionary/Delete",statusChange:"/PlatForm/System/Dictionary/StatusChange",setSelected:"/PlatForm/System/Dictionary/SetSelected",move:"/PlatForm/System/Dictionary/Move"},treeObj:null,treeSelectedNode:null,treeSetting:{async:{enable:!0,url:""},data:{key:{name:"dictGroupText"},simpleData:{enable:!0,idKey:"dictGroupId",pIdKey:"dictGroupParentId",rootId:0}},callback:{onClick:function(e,t,i){appList.treeSelectedNode=i,appList.reloadTreeTableData()},onAsyncSuccess:function(e,t,i,l){appList.treeObj.expandAll(!0)}}},treeTableObject:null,treeTableConfig:{CanDeleteWhenHasChild:!1,IdField:"dictId",RowIdPrefix:"TreeTable_",LoadChildJsonURL:"",LoadChildFunc:null,OpenLevel:1,ChildTestField:"dictChildCount",Templates:[{Title:"字典名称",FieldName:"dictText",TitleCellClassName:"TitleCell",Renderer:"Lable",Hidden:!1,TitleCellAttrs:{},Width:"40"},{Title:"字典值",FieldName:"dictValue",TitleCellClassName:"TitleCell",Renderer:"Lable",Hidden:!1,TitleCellAttrs:{},Width:"40",TextAlign:"center"},{Title:"字典状态",FieldName:"dictStatus",TitleCellClassName:"TitleCell",Renderer:"Lable",Hidden:!1,TitleCellAttrs:{},Width:"10%",TextAlign:"center"},{Title:"默认选中",FieldName:"dictIsSelected",TitleCellClassName:"TitleCell",Renderer:"Lable",Hidden:!1,TitleCellAttrs:{},Width:"10%",TextAlign:"center"}],TableClass:"TreeTable",RendererTo:"divTreeTable",TableId:"TreeTable",TableAttrs:{cellpadding:"0",cellspacing:"0",border:"0"}}},methods:{initTree:function(){this.treeSetting.async.url=BaseUtility.BuildAction(this.acInterface.getGroupTreeData,{}),this.treeObj=$.fn.zTree.init($("#zTreeUL"),this.treeSetting)},addGroup:function(){if(null!=this.treeSelectedNode){var e=BaseUtility.BuildView(this.acInterface.groupEditView,{op:"add",parentId:this.treeSelectedNode.dictGroupId});DialogUtility.Frame_OpenIframeWindow(window,DialogUtility.DialogId,e,{title:"字典分组"},2)}else DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},"请选择父节点!",null)},editGroup:function(){if(null!=this.treeSelectedNode){var e=BaseUtility.BuildView(this.acInterface.groupEditView,{op:"update",recordId:this.treeSelectedNode.dictGroupId});DialogUtility.Frame_OpenIframeWindow(window,DialogUtility.DialogId,e,{title:"字典分组"},2)}else DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},"请选择需要编辑的节点!",null)},viewGroup:function(){var e=BaseUtility.BuildView(this.acInterface.groupEditView,{op:"view",recordId:this.treeSelectedNode.dictGroupId});DialogUtility.Frame_OpenIframeWindow(window,DialogUtility.DialogId,e,{title:"字典分组"},2)},delGroup:function(){var e=this.treeSelectedNode.dictGroupId,t=this;DialogUtility.Confirm(window,"确认要删除选定的节点吗？",function(){AjaxUtility.Post(t.acInterface.deleteGroup,{recordId:e},function(e){e.success?DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},e.message,function(){appList.treeObj.removeNode(appList.treeSelectedNode),appList.treeSelectedNode=null}):DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},e.message,function(){})},"json")})},newTreeNode:function(e,t,i,l){var a={dictGroupId:e,dictGroupValue:t,dictGroupText:i,dictGroupParentId:l};appList.treeObj.addNodes(this.treeSelectedNode,a,!1)},updateNode:function(e,t){this.treeSelectedNode.dictGroupValue=e,this.treeSelectedNode.dictGroupText=t,appList.treeObj.updateNode(this.treeSelectedNode)},reloadTreeTableData:function(){var i=this,l={groupId:this.treeSelectedNode.dictGroupId,groupName:this.treeSelectedNode.dictGroupText};AjaxUtility.Post(this.acInterface.getDictData,l,function(e){if(e.success){null==e.data&&(e.data=new Array),e.data.push({dictId:l.groupId,dictKey:l.groupId,dictValue:l.groupName,dictText:l.groupName,dictStatus:"",dictIsSelected:"",dictCreateTime:""});var t=JsonUtility.ParseArrayJsonToTreeJson({KeyField:"dictId",RelationField:"dictParentId",ChildFieldName:"Nodes"},e.data,l.groupId);$("#divTreeTable").html(""),i.treeTableObject=Object.create(TreeTable),i.treeTableObject.Initialization(i.treeTableConfig),i.treeTableObject.LoadJsonData(t)}},"json")},mareSureSelectedTreeTableRow:function(e){if(null==this.treeTableObject)return DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},"请先选定分组!",null),{then:function(e){}};var t=this.treeTableObject.GetSelectedRowData();return null==t?(DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},"请选择需要"+e+"的字典!",null),{then:function(e){}}):t.dictId==this.treeSelectedNode.dictGroupId?(DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},"不能编辑根节点!",null),{then:function(e){}}):{then:function(e){e.call(appList,t)}}},add:function(){if(null!=this.treeTableObject){var e=this.treeTableObject.GetSelectedRowData();if(null==e)return DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},"请选择上级字典!",null),!1;var t=BaseUtility.BuildView(this.acInterface.dictEditView,{dictParentId:e.dictId,op:"add",dictGroupId:this.treeSelectedNode.dictGroupId});DialogUtility.Frame_OpenIframeWindow(window,DialogUtility.DialogId,t,{title:"字典管理"},2)}},edit:function(){this.mareSureSelectedTreeTableRow("编辑").then(function(e){var t=BaseUtility.BuildView(this.acInterface.dictEditView,{op:"update",recordId:e.dictId});DialogUtility.Frame_OpenIframeWindow(window,DialogUtility.DialogId,t,{title:"字典管理"},2)})},del:function(){this.mareSureSelectedTreeTableRow("删除").then(function(e){var t=e.dictId,i=this;DialogUtility.Confirm(window,"确认要删除选定的节点吗？",function(){AjaxUtility.Post(i.acInterface.deleteDict,{recordId:t},function(e){e.success?DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},e.message,function(){i.treeTableObject.DeleteRow(t)}):DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},e.message,null)},"json")})})},view:function(){this.mareSureSelectedTreeTableRow("编辑").then(function(e){var t=BaseUtility.BuildView(this.acInterface.dictEditView,{op:"view",recordId:e.dictId});DialogUtility.Frame_OpenIframeWindow(window,DialogUtility.DialogId,t,{title:"字典管理"},2)})},statusEnable:function(l){this.mareSureSelectedTreeTableRow("启用").then(function(t){var e=t.dictId,i=this;AjaxUtility.Post(this.acInterface.statusChange,{ids:e,status:l},function(e){e.success?DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},e.message,function(){t.dictStatus=l,i.treeTableObject.UpdateToRow(t.dictId,t)}):DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},e.message,null)},"json")})},setSelected:function(){this.mareSureSelectedTreeTableRow("选中").then(function(i){var e=i.dictId,l=this;AjaxUtility.Post(this.acInterface.setSelected,{recordId:e},function(e){e.success?DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},e.message,function(){for(var e=l.treeTableObject.GetBrothersNodeDatasByParentId(i.dictId),t=0;t<e.length;t++)e[t].dictIsSelected="否",l.treeTableObject.UpdateToRow(e[t].dictId,e[t]);i.dictIsSelected="是",l.treeTableObject.UpdateToRow(i.dictId,i)}):DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},e.message,null)},"json")})},move:function(l){this.mareSureSelectedTreeTableRow("选中").then(function(t){var e=t.dictId,i=this;AjaxUtility.Post(this.acInterface.move,{recordId:e,type:l},function(e){e.success?DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},e.message,function(){"down"==l?i.treeTableObject.MoveDownRow(t.dictId):i.treeTableObject.MoveUpRow(t.dictId)}):DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},e.message,null)},"json")})},newTreeTableNode:function(e,t,i,l,a,d,o,r){var n={dictId:e,dictKey:t,dictValue:i,dictText:l,dictGroupId:a,dictCreateTime:d,dictStatus:o,dictIsSelected:r};this.treeTableObject.AppendChildRowToCurrentSelectedRow(n)},updateTreeTableNode:function(e,t,i,l,a,d){var o={dictId:e,dictKey:t,dictValue:i,dictText:l,dictStatus:a,dictIsSelected:d};this.treeTableObject.UpdateToRow(e,o)}}})</script></body></html>