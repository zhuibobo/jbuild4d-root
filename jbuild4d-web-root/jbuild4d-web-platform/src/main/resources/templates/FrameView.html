<!--
  Created by IntelliJ IDEA.
  User: zhuangrb
  Date: 2018/8/26
  To change this template use File | Settings | File Templates.
--><!DOCTYPE html><html lang="zh" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"><head><th:block th:replace="Fragment/GeneralLib::GeneralLib"></th:block><th:block th:replace="Fragment/GeneralLib::ThemesLib"></th:block></head><body style="height:100%;overflow:hidden"><div id="app"><div class="frame-layout"><layout :style="{minHeight: '100vh'}"><i-header style="padding:0 10px" class="header-wrap"><div style="width:100%;height:65px"><div class="layout-logo"><icon type="ios-monitor-outline"></icon>&nbsp;&nbsp;JBuild4D-V-0.31</div><div class="top-menu-item-warp"><div class="top-menu-item-inner-warp"><div :class="topMenuItemClass(item)" @click="topMenuClick(item,true)" v-for="(item, key) in topMenuArrayJson" topmenu="true">{{item.menuText}}</div></div></div><div class="top-menu-op-c"><div class="right" @click="nextTopMenu()"></div><div class="left" @click="prevTopMenu()"></div></div><div class="top-right-wrap"><div class="user-warp"><div class="user-header"></div><div class="line"></div><div style="float:left"><div style="line-height:24px;margin-top:8px">用户名：{{userInfo.userName}}</div><div style="line-height:24px;overflow-x:hidden;width:130px;white-space:nowrap;text-overflow:ellipsis">部&nbsp;&nbsp;&nbsp;&nbsp;门：{{userInfo.organName}}</div></div></div><div class="logout" @click="logout()"></div></div></div><div class="header-shadow-line" style="height:4px;width:100%"></div></i-header><layout><sider hide-trigger :style="sider_style" width="300"><iframe id="leftMenuIframe" :src="leftIframeUrl" frameborder="0" style="width:100%;height:99%"></iframe></sider><layout :style="{padding: '0 24px 24px'}"><breadcrumb :style="{margin: '10px 0'}"><breadcrumb-item v-for="(item,key) in breadcrumbArrayJson">{{item.text}}</breadcrumb-item></breadcrumb><i-content :style="{padding: '24px', minHeight: '480px', background: '#fff'}"><iframe name="iframe" :src="contentIframeUrl" width="100%" :height="frameHeight" frameborder="0"></iframe></i-content></layout></layout></layout></div></div><script type="text/javascript">var IsTopFramePage=!0,menuJsonSource=[],app=new Vue({data:{menuJson:null,menuJsonSource:null,topMenuArrayJson:null,leftMenuArrayJson:null,breadcrumbArrayJson:[{text:"JBuild4D"}],frameHeight:0,contentIframeUrl:BaseUtility.BuildView("/PlatForm/Base/RightContentView"),leftIframeUrl:BaseUtility.BuildView("/PlatForm/Base/LeftMenuView"),defaultLeftIframeUrl:BaseUtility.BuildView("/PlatForm/Base/LeftMenuView"),defaultContentIframeUrl:BaseUtility.BuildView("/PlatForm/Base/RightContentView"),logoutUrl:BaseUtility.BuildView("/LoginView"),userInfo:{}},mounted:function(){this.setFrameHeight(),this.contentIframeUrl=this.contentIframeUrl,AjaxUtility.Post("/PlatForm/System/Menu/GetMyMenu",{},function(e){menuJsonSource=e.data;for(var t=0;t<menuJsonSource.length;t++)menuJsonSource[t].selected=!1;app.menuJson=JsonUtility.ParseArrayJsonToTreeJson({KeyField:"menuId",RelationField:"menuParentId",ChildFieldName:"items"},menuJsonSource,"0"),app.menuJsonSource=menuJsonSource,app.topMenuArrayJson=app.menuJson.items,app.leftMenuArrayJson=app.menuJson.items[0].items,app.topMenuClick(app.topMenuArrayJson[0],!1)},"json"),app.userInfo=CacheDataUtility.GetCurrentUserInfo()},created:function(){},methods:{topMenuItemClass:function(e){return e.selected?"top-menu-item top-menu-item-selected "+e.menuClassName:"top-menu-item "+e.menuClassName},unSelectedAllTopMenu:function(){for(var e=0;e<this.topMenuArrayJson.length;e++)this.topMenuArrayJson[e].selected=!1},topMenuHasNextPage:function(){for(var e=$(".frame-top-menu-item-warp").width(),t=$("[topmenu='true']"),n=0,r=0;r<t.length;r++)n+=$(t[r]).outerWidth(!0);return e<n},nextTopMenu:function(){if(this.topMenuHasNextPage()){var e=$(".frame-top-menu-item-warp"),t=$(".frame-top-menu-item-inner-warp"),n=.9*e.width(),r=t.css("left"),u=0;"auto"!=r&&(u=parseInt(r));var a=t.width(),i=u-n;-i>a-e.width()&&(i=-(a-e.width())),t.animate({left:i},1e3)}},prevTopMenu:function(){var e=$(".frame-top-menu-item-warp"),t=$(".frame-top-menu-item-inner-warp"),n=parseInt(t.css("left"));if(n<0){var r=n+.9*e.width();0<r&&(r=0),t.animate({left:r},1e3)}},getMenu:function(e){for(var t=0;t<this.menuJsonSource.length;t++)if(this.menuJsonSource[t].menuId==e)return this.menuJsonSource[t];return null},buildBreadcrumbByMenuId:function(e){var t=this.getMenu(e),n=new Array;if(null!=t&&(n.push({text:t.menuText}),"0"!=t.menuParentId)){var r=this.getMenu(t.menuParentId);n.push({text:r.menuText}),"0"!=r.menuParentId&&(r=this.getMenu(r.menuParentId),n.push({text:r.menuText}),"0"!=r.menuParentId&&(r=this.getMenu(r.menuParentId),n.push({text:r.menuText})))}n=n.reverse(),this.setBreadcrumbArrayJson(n)},topMenuClick:function(e,t){this.unSelectedAllTopMenu(),e.selected=!0,this.leftMenuArrayJson=e.items,0<=this.leftIframeUrl.indexOf("/PlatForm/Base/LeftMenu.do")&&t&&($("#leftMenuIframe")[0].contentWindow.app.leftMenuArrayJson=app.leftMenuArrayJson),this.buildBreadcrumbByMenuId(e.menuId),""!=e.menuRightUrl&&null!=e.menuRightUrl?this.contentIframeUrl=e.menuRightUrl:this.contentIframeUrl=this.defaultContentIframeUrl,""==e.menuLeftUrl||null==e.menuLeftUrl||"/LeftMenuView"==e.menuLeftUrl?($("#leftMenuIframe").on("load",function(){$("#leftMenuIframe")[0].contentWindow.app.leftMenuArrayJson=app.leftMenuArrayJson,$("#leftMenuIframe").unbind("load")}),this.leftIframeUrl=this.defaultLeftIframeUrl):this.leftIframeUrl=BaseUtility.BuildView(e.menuLeftUrl)},setFrameHeight:function(){this.mainHeight=PageStyleUtility.GetWindowHeight()-90-60,this.frameHeight=this.mainHeight-30},setBreadcrumbArrayJson:function(e){this.breadcrumbArrayJson=e},setContentIframeUrl:function(e){this.contentIframeUrl=BaseUtility.GetRootPath()+e},logout:function(){window.location.href=this.logoutUrl}},computed:{sider_style:function(){return{background:"#fff",height:$(window).height()-65+"px",overflow:"auto"}}}});app.$mount("#app")</script></body></html>