<!DOCTYPE html><html lang="zh" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"><head><meta charset="UTF-8"><title>Title</title><th:block th:replace="Fragment/GeneralLib::GeneralLib"></th:block><th:block th:replace="Fragment/GeneralLib::IViewLib"></th:block><th:block th:replace="Fragment/GeneralLib::JQueryUILib"></th:block><th:block th:replace="Fragment/GeneralLib::EditTableLib"></th:block><th:block th:replace="Fragment/GeneralLib::ThemesLib"></th:block><th:block th:replace="Fragment/GeneralLib::ZTreeLib"></th:block><th:block th:replace="Fragment/GeneralLib::ZTreeExtendLib"></th:block><style>.select-table-wraper{border:#2d8cf0 1px solid;border-radius:4px;padding:10px;position:absolute;left:0;right:51%;bottom:50px;top:10px}.select-field-wraper{border:#2d8cf0 1px solid;border-radius:4px;padding:10px;position:absolute;left:51%;right:0;bottom:50px;top:10px}.select-old-field-tr td{background-color:#fcffdc!important}</style></head><body><div id="appSelectView"><div class="select-table-wraper"><divider orientation="left" :dashed="true" style="font-size:12px">选择表</divider><input type="text" id="txtSearchTableTree" style="width:100%;height:32px;margin-top:2px"><ul id="tableZTreeUL" class="ztree"></ul></div><div class="select-field-wraper"><divider orientation="left" :dashed="true" style="font-size:12px">选择字段</divider><i-table border :columns="fieldTable.columnsConfig" :data="fieldTable.fieldData" class="iv-list-table" :highlight-row="true" @on-row-click="selectedField" :height="fieldTable.tableHeight" size="small" no-data-text="请选择表"></i-table></div><div style="position:absolute;bottom:0;width:100%;text-align:center"><i-button type="primary" @click="selectComplete()">确 认</i-button><i-button style="margin-left:8px" type="primary" @click="clearComplete()">清 空</i-button><i-button style="margin-left:8px" @click="handleClose()">关 闭</i-button></div></div><script>var appSelectView=new Vue({el:"#appSelectView",data:{acInterface:{getTablesDataUrl:"/PlatForm/Builder/DataStorage/DataBase/Table/GetTablesForZTreeNodeList",getTableFieldsDataUrl:"/PlatForm/Builder/DataStorage/DataBase/Table/GetTableFieldsByTableId"},selectedData:{tableId:"",tableName:"",tableCaption:"",fieldName:"",fieldCaption:"",fieldDataType:"",fieldLength:""},tableTree:{tableTreeObj:null,tableTreeSetting:{view:{dblClickExpand:!1,showLine:!0,fontCss:{color:"black","font-weight":"normal"}},check:{enable:!0,nocheckInherit:!1,chkStyle:"radio",radioType:"all"},data:{key:{name:"text"},simpleData:{enable:!0,idKey:"id",pIdKey:"parentId",rootPId:"-1"}},callback:{onClick:function(e,t,a){"Table"==a.nodeTypeName?(appSelectView.tableTree.tableTreeObj.checkNode(a,!0,!0),appSelectView.selectedData.tableId=a.id,appSelectView.selectedData.tableName=a.value,appSelectView.selectedData.tableCaption=a.attr1,appSelectView.selectedData.fieldName="",appSelectView.selectedData.fieldCaption="",appSelectView.selectedData.fieldDataType="",appSelectView.selectedData.fieldLength="",appSelectView.bindFieldTable()):(appSelectView.selectedData.tableId="",appSelectView.selectedData.tableName="",appSelectView.selectedData.tableCaption="",appSelectView.selectedData.fieldName="",appSelectView.selectedData.fieldCaption="",appSelectView.selectedData.fieldDataType="",appSelectView.selectedData.fieldLength="",appSelectView.fieldTable.fieldData=[])},onDblClick:function(e,t,a){},onAsyncSuccess:function(e,t,a,l){}}},tableTreeData:null,selectedTableName:"无"},fieldTable:{fieldData:[],tableHeight:470,columnsConfig:[{title:"名称",key:"fieldName",align:"center"},{title:"标题",key:"fieldCaption",align:"center"}]}},mounted:function(){this.bindOldSelectedValue(),this.bindHistorySelectedValue(),this.bindTableTree()},methods:{bindTableTree:function(){var a=this;AjaxUtility.Post(this.acInterface.getTablesDataUrl,{},function(e){if(e.success){if(a.tableTree.tableTreeData=e.data,a.tableTree.tableTreeObj=$.fn.zTree.init($("#tableZTreeUL"),a.tableTree.tableTreeSetting,a.tableTree.tableTreeData),a.tableTree.tableTreeObj.expandAll(!0),fuzzySearch("tableZTreeUL","#txtSearchTableTree",null,!0),!StringUtility.IsNullOrEmpty(a.selectedData.tableId)){var t=a.tableTree.tableTreeObj.getNodeByParam("id",a.selectedData.tableId);a.tableTree.tableTreeObj.checkNode(t,!0,!0),a.bindFieldTable()}}else DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},e.message,null)},"json")},bindFieldTable:function(){var a=this;StringUtility.IsNullOrEmpty(this.selectedData.tableId)?DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},"请先选择表!",null):AjaxUtility.Post(this.acInterface.getTableFieldsDataUrl,{tableId:this.selectedData.tableId},function(e){if(e.success){a.fieldTable.fieldData=e.data;var t=a.selectedData;StringUtility.IsNullOrEmpty(t.tableId)||StringUtility.IsNullOrEmpty(t.fieldName)||window.setTimeout(function(){$("span").each(function(e){$(this).html()==t.fieldName&&$(this).parent().parent().parent().addClass("select-old-field-tr")})},300)}else DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},e.message,null)},"json")},bindOldSelectedValue:function(){var e=window.OpenerWindowObj[this.getSelectInstanceName()].getSelectFieldResultValue();StringUtility.IsNullOrEmpty(e.tableId)||(this.selectedData.tableId=e.tableId,this.selectedData.tableName=e.tableName,this.selectedData.tableCaption=e.tableCaption,this.selectedData.fieldName=e.fieldName,this.selectedData.fieldCaption=e.fieldCaption,this.selectedData.fieldDataType=e.fieldDataType,this.selectedData.fieldLength=e.fieldLength)},bindHistorySelectedValue:function(){if(StringUtility.IsNullOrEmpty(this.selectedData.tableId)){var e=CookieUtility.GetCookie("SBTF_TableId");if(!StringUtility.IsNullOrEmpty(e)){var t=CookieUtility.GetCookie("SBTF_TableName"),a=CookieUtility.GetCookie("SBTF_TableCaption");this.selectedData.tableId=e,this.selectedData.tableName=t,this.selectedData.tableCaption=a}}},setHistorySelectedTableDataToCookie:function(e,t,a){CookieUtility.SetCookie1Month("SBTF_TableId",e),CookieUtility.SetCookie1Month("SBTF_TableName",t),CookieUtility.SetCookie1Month("SBTF_TableCaption",a)},getSelectInstanceName:function(){return BaseUtility.GetUrlParaValue("instanceName")},selectedField:function(e,t){this.selectedData.fieldName=e.fieldName,this.selectedData.fieldCaption=e.fieldCaption,this.selectedData.fieldDataType=e.fieldDataType,this.selectedData.fieldLength=e.fieldDataLength},selectComplete:function(){var e=this.selectedData;StringUtility.IsNullOrEmpty(e.tableId)||StringUtility.IsNullOrEmpty(e.fieldName)?DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},"请选择需要绑定的字段!",null):(window.OpenerWindowObj[this.getSelectInstanceName()].setSelectFieldResultValue(e),this.setHistorySelectedTableDataToCookie(e.tableId,e.tableName,e.tableCaption),this.handleClose())},clearComplete:function(){window.OpenerWindowObj[this.getSelectInstanceName()].setSelectFieldResultValue(null),this.handleClose()},handleClose:function(){window.IsOpenForFrame?DialogUtility.Frame_CloseDialog(window):DialogUtility.CloseOpenIframeWindow(window,DialogUtility.DialogId)}}})</script></body></html>