<!--
  Created by IntelliJ IDEA.
  User: zhuangrb
  Date: 2018/8/26
  To change this template use File | Settings | File Templates.
--><!DOCTYPE html><html lang="zh" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"><head><meta charset="UTF-8"><title>Title</title><th:block th:replace="Fragment/GeneralLib::GeneralLib"></th:block><th:block th:replace="Fragment/GeneralLib::IViewLib"></th:block><th:block th:replace="Fragment/GeneralLib::JQueryUILib"></th:block><th:block th:replace="Fragment/GeneralLib::ThemesLib"></th:block><th:block th:replace="Fragment/GeneralLib::TreeTableLib"></th:block></head><body><div id="appList"><div class="list-button-outer-wrap" id="list-button-wrap"><div class="list-button-inner-wrap" style="margin-bottom:10px"><i-button type="success" @click="add()"><icon type="plus"></icon>新增</i-button><i-button type="primary" @click="edit()"><icon type="edit"></icon>修改</i-button><i-button type="primary" @click="del()"><icon type="trash-a"></icon>删除</i-button><i-button type="primary" @click="view()"><icon type="android-open"></icon>浏览</i-button><i-button type="primary" @click="statusEnable('启用')"><icon type="checkmark-round"></icon>启用</i-button><i-button type="primary" @click="statusEnable('禁用')"><icon type="minus-round"></icon>禁用</i-button><i-button type="primary" @click="move('up')"><icon type="arrow-up-b"></icon>上移</i-button><i-button type="primary" @click="move('down')"><icon type="arrow-down-b"></icon>下移</i-button></div><div style="clear:both"></div></div><div id="divTreeTable" style="width:100%;margin:auto"></div></div><script>var treeTableObj=null,appList=new Vue({el:"#appList",mounted:function(){this.reloadTreeTableData()},data:{acInterface:{editView:"/PlatForm/OrganRelevance/Organ/DetailView",reloadData:"/PlatForm/OrganRelevance/Organ/GetListData",delete:"/PlatForm/OrganRelevance/Organ/Delete",statusChange:"/PlatForm/OrganRelevance/Organ/StatusChange",move:"/PlatForm/OrganRelevance/Organ/Move"},treeTableObject:null,treeTableConfig:{CanDeleteWhenHasChild:!1,IdField:"organId",RowIdPrefix:"TreeTable_",LoadChildJsonURL:"",LoadChildFunc:null,OpenLevel:1,ChildTestField:"organChildCount",Templates:[{Title:"组织名称",FieldName:"organName",TitleCellClassName:"TitleCell",Renderer:"Lable",Hidden:!1,TitleCellAttrs:{},Width:"40"},{Title:"简称",FieldName:"organShortName",TitleCellClassName:"TitleCell",Renderer:"Lable",Hidden:!1,TitleCellAttrs:{},Width:"40",TextAlign:"center"},{Title:"创建时间",FieldName:"organCreateTime",TitleCellClassName:"TitleCell",Renderer:"DateTime",Hidden:!1,TitleCellAttrs:{},Width:"40",TextAlign:"center"},{Title:"状态",FieldName:"organStatus",TitleCellClassName:"TitleCell",Renderer:"Lable",Hidden:!1,TitleCellAttrs:{},Width:"10%",TextAlign:"center"}],TableClass:"TreeTable",RendererTo:"divTreeTable",TableId:"TreeTable",TableAttrs:{cellpadding:"0",cellspacing:"0",border:"0"}}},methods:{reloadTreeTableData:function(){var i=this;AjaxUtility.Post(this.acInterface.reloadData,{pageSize:2e3,pageNum:1},function(e){if(e.success){null==e.data&&(e.data=new Array);var t=JsonUtility.ParseArrayJsonToTreeJson({KeyField:"organId",RelationField:"organParentId",ChildFieldName:"Nodes"},e.data.list,"0");$("#divTreeTable").html(""),i.treeTableObject=Object.create(TreeTable),i.treeTableObject.Initialization(i.treeTableConfig),i.treeTableObject.LoadJsonData(t)}else DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},e.message,null)},"json")},mareSureSelectedTreeTableRow:function(e){var t=this.treeTableObject.GetSelectedRowData();return null==t?(DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},"请选择需要"+e+"的节点!",null),{then:function(e){}}):"0"==t[appList.treeTableConfig.IdField]?(DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},"不能编辑根节点!",null),{then:function(e){}}):{then:function(e){e.call(appList,t)}}},add:function(){if(null!=this.treeTableObject){var e=this.treeTableObject.GetSelectedRowData();if(null==e)return DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},"请选择上级组织!",null),!1;var t=BaseUtility.BuildAction(this.acInterface.editView,{parentId:e[this.treeTableConfig.IdField],op:"add"});DialogUtility.Frame_OpenIframeWindow(window,DialogUtility.DialogId,t,{title:"组织管理"},1)}},edit:function(){this.mareSureSelectedTreeTableRow("编辑").then(function(e){var t=BaseUtility.BuildAction(this.acInterface.editView,{op:"update",recordId:e[this.treeTableConfig.IdField]});DialogUtility.Frame_OpenIframeWindow(window,DialogUtility.DialogId,t,{title:"组织管理"},1)})},del:function(){this.mareSureSelectedTreeTableRow("删除").then(function(e){var t=e[this.treeTableConfig.IdField],i=this;DialogUtility.Confirm(window,"确认要删除选定的节点吗？",function(){AjaxUtility.Post(i.acInterface.delete,{recordId:t},function(e){e.success?DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},e.message,function(){i.treeTableObject.DeleteRow(t)}):DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},e.message,null)},"json")})})},view:function(){this.mareSureSelectedTreeTableRow("编辑").then(function(e){var t=BaseUtility.BuildAction(this.acInterface.editView,{op:"view",recordId:e[this.treeTableConfig.IdField]});DialogUtility.Frame_OpenIframeWindow(window,DialogUtility.DialogId,t,{title:"组织管理"},1)})},statusEnable:function(i){var l=this;this.mareSureSelectedTreeTableRow("启用").then(function(t){var e=t[appList.treeTableConfig.IdField];AjaxUtility.Post(this.acInterface.statusChange,{ids:e,status:i},function(e){e.success?DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},e.message,function(){t.organStatus=i,l.treeTableObject.UpdateToRow(t[appList.treeTableConfig.IdField],t)}):DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},e.message,null)},"json")})},move:function(i){var l=this;this.mareSureSelectedTreeTableRow("选中").then(function(t){var e=t[appList.treeTableConfig.IdField];AjaxUtility.Post(this.acInterface.move,{recordId:e,type:i},function(e){e.success?DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},e.message,function(){"down"==i?l.treeTableObject.MoveDownRow(t[appList.treeTableConfig.IdField]):l.treeTableObject.MoveUpRow(t[appList.treeTableConfig.IdField])}):DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},e.message,null)},"json")})},newTreeTableNode:function(e){this.treeTableObject.AppendChildRowToCurrentSelectedRow(e)},updateTreeTableNode:function(e){this.treeTableObject.UpdateToRow(e[appList.treeTableConfig.IdField],e)}}})</script></body></html>